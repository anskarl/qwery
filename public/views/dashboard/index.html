<div ng-controller="DashboardController" ng-init="init()">
    <div class="row">
        <div class="col-md-6">
            <table>
               <tr>
                   <td ng-repeat="state in jobStates">
                       <span ng-show="state === selectedJobState" class="dashboard_selected_state">{{ state }}</span>
                       <span ng-hide="state === selectedJobState" class="dashboard_state">
                           <a ng-click="updateJobState(state)">{{ state }}</a>
                       </span>
                       &nbsp;
                   </td>
               </tr>
            </table>
        </div>
        <div class="col-md-6">
            <div class="pull-right" style="margin-right: 10px">
                Max Results:
                <select ng-model="maxResults" ng-options="value as value for value in maxResultsSet">
                </select>
            </div>
        </div>
    </div>
    <div>
        <div class="jobs_shown">{{ getDashboardJobs().length }} job(s) shown</div>
        <div class="warning" ng-hide="getDashboardJobs().length">No matching jobs found</div>
        <div ng-show="getDashboardJobs().length" ng-class="selectedJob ? 'col-md-6' : 'col-md-12'">
            <div class="row">
                <div ng-class="selectedJob ? 'col-md-5' : 'col-md-2'" class="bold left">Workflow</div>
                <div ng-class="selectedJob ? 'col-md-7' : 'col-md-4'" class="bold left">Source</div>
                <div ng-hide="selectedJob" class="col-md-4 bold center">Status</div>
                <div ng-hide="selectedJob" class="col-md-2 bold center">Last Updated</div>
            </div>
            <div ng-repeat="job in getDashboardJobs() | orderBy:'-lastUpdated'"
                 ng-click="selectJob(job)"
                 ng-class="selectedJob == job ? 'highlight' : ''" class="row">
                <div ng-class="selectedJob ? 'col-md-5' : 'col-md-2'">
                    <img ng-src="{{ getJobStatusBulb(job) }}"> {{ job.workflowName }}
                </div>
                <div ng-class="selectedJob ? 'col-md-7' : 'col-md-4'">{{ job.name }}</div>
                <div ng-hide="selectedJob" class="col-md-4">
                    <span ng-show="job.state === 'SUCCESS'" class="status_success">100%</span>
                    <span ng-hide="job.state === 'SUCCESS'" ng-class="getJobStatusClass(job)">{{ getJobCompletion(job) || 0 | number:1 }}%</span>
                </div>
                <div ng-hide="selectedJob" class="col-md-2">
                    {{ job.lastUpdated | date:'MM/dd/yy HH:mm:ss' }}
                </div>
            </div>
        </div>
        <div ng-show="selectedJob" ng-class="selectedJob ? 'col-md-6' : ''" class="dashboard_border">
            <table class="col-md-12">
                <tr>
                    <th>Workflow</th>
                    <td>{{ selectedJob.workflowName }}</td>
                </tr>
                <tr>
                    <th>File</th>
                    <td>{{ selectedJob.name }}</td>
                </tr>
                <tr>
                    <th>File Size</th>
                    <td>{{ selectedJob.inputSize | bytes }}</td>
                </tr>
                <tr>
                    <th>Host</th>
                    <td>
                        <span ng-show="getSlaveForJob(selectedJob).name">
                            {{ getSlaveForJob(selectedJob).name }} (<span class="small">{{ selectedJob.processingHost }}</span>)
                        </span>
                        <span ng-hide="getSlaveForJob(selectedJob).name">{{ job.processingHost }}</span>
                    </td>
                </tr>
                <tr>
                    <th>State</th>
                    <td ng-class="getJobStatusClass(selectedJob)">{{ selectedJob.state }}</td>
                </tr>
                <tr>
                    <th>CPU Load</th>
                    <td>
                        <span ng-show="selectedJob.statistics.cpuLoad">{{ selectedJob.statistics.cpuLoad }}%</span>
                        <span ng-hide="selectedJob.statistics.cpuLoad" class="null">N/A</span>
                    </td>
                </tr>
                <tr>
                    <th>Estimated Completion</th>
                    <td>
                        <span ng-show="selectedJob.statistics.completionTime">{{ selectedJob.statistics.completionTime | duration }}</span>
                        <span ng-hide="selectedJob.statistics.completionTime" class="null">N/A</span>
                    </td>
                </tr>
                <tr ng-show="selectedJob.message">
                    <th>Error</th>
                    <td><span class="error">{{ selectedJob.message }}</span></td>
                </tr>
                <tr>
                    <th>Last Updated</th>
                    <td>{{ selectedJob.lastUpdated | date:'MM/dd/yyyy hh:mm:ss' }}</td>
                </tr>
                <tr>
                    <td ng-click="selectJob(null)" class="clickable">
                        <i class="fa fa-arrow-left bold" style="color: #00cc00"> Back</i>
                    </td>
                    <td>
                        <i ng-show="isResumable(selectedJob) && !resuming" ng-click="resumeJob(selectedJob)" title="Resume job" class="fa fa-2x fa-play-circle play_button clickable"></i>
                        <i ng-show="!isResumable(selectedJob) && !resuming" class="fa fa-2x fa-play-circle null"></i>
                        <img ng-show="resuming" src="/images/statuses/loading24.gif" style="vertical-align: top">

                        <i ng-show="isPausable(selectedJob) && !pausing" ng-click="pauseJob(selectedJob)" title="Pause job" class="fa fa-2x fa-pause-circle pause_button clickable"></i>
                        <i ng-show="!isPausable(selectedJob) && !pausing" class="fa fa-2x fa-pause-circle null"></i>
                        <img ng-show="pausing" src="/images/statuses/loading24.gif" style="vertical-align: top">

                        <i ng-show="isStoppable(selectedJob) && !stopping" ng-click="stopJob(selectedJob)" title="Stop job" class="fa fa-2x fa-stop-circle stop_button clickable"></i>
                        <i ng-show="!isStoppable(selectedJob) && !stopping" class="fa fa-2x fa-stop-circle null"></i>
                        <img ng-show="stopping" src="/images/statuses/loading24.gif" style="vertical-align: top">
                    </td>
                </tr>
                <tr>
                    <td ng-repeat="stats in selectedJob.statistics">
                        <div class="col-md-12">
                            <table class="col-md-12">
                                <tr>
                                    <th>Records</th>
                                    <td>
                                        {{ stats.totalInserted | number }}
                                        <span style="color: #00aa00">
                                        <i class="fa fa-arrow-up"></i> {{ stats.recordsDelta | number }}
                                    </span>
                                    </td>
                                </tr>
                                <tr ng-show="stats">
                                    <th>Record/sec</th>
                                    <td>{{ stats.recordsPerSecond | number:1 }}</td>
                                </tr>
                                <tr ng-show="stats">
                                    <th>Bytes Read</th>
                                    <td>{{ stats.bytesRead | bytes }}</td>
                                </tr>
                                <tr ng-show="stats">
                                    <th>Bytes/sec</th>
                                    <td>{{ stats.bytesPerSecond | bps }}</td>
                                </tr>
                            </table>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>